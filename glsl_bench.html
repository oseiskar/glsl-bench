<!DOCTYPE html>
<html lang="en">
    <head>
        <title>GLSL bench</title>
        <meta charset="utf-8">
        <style>
        body.fullscreen {
          margin: 0 !important;
          overflow: hidden !important;
        }
        </style>
    </head>
    <body>
        <div id="shader-container">
        </div>
        <script src="js_libs/jquery-2.1.4.min.js"></script>
        <script src="js_libs/three.min.js"></script>
        <script src="js_libs/Detector.js"></script>
        <script>
          if (!Detector.webgl) Detector.addGetWebGLMessage();
        </script>
        <script src="glsl_bench.js"></script>
        <script src="build/tracer_data.js"></script>
        <script>
          // stupid helpers
          function parseQueryString() {
              const params = {};
              const qstring = window.location.search.split('?')[1];
              if (qstring === undefined) return params;
              const strs = qstring.split('&');
              for (let i in strs) {
                  const nameAndValue = strs[i].split('=');
                  params[nameAndValue[0]] = decodeURIComponent(nameAndValue[1]);
              }
              return params;
          }

          $(document).ready(function() {
            const params = parseQueryString();

            const runtimeShaderParams = {};
            if (params.fullscreen) {
              $('body').toggleClass('fullscreen', true);
              runtimeShaderParams.resolution = 'auto';
            }
            if (params.batch_size) {
              runtimeShaderParams.batch_size = parseInt(params.batch_size);
            }

            const element = $('#shader-container')[0];
            if (params.dynamicTracer) {
              const spec = dynamicTracers[params.dynamicTracer];
              for (let param in runtimeShaderParams) {
                spec[param] = runtimeShaderParams[param];
              }
              new GLSLBench({ element, spec });
            } else if (params.shader) {
              new GLSLBench({ element, url: params.shader });
            }
            else {
              throw "Please define a shader JSON in the query string";
            }
          });
        </script>
    </body>
</html>
